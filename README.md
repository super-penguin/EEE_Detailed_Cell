# Embedded Ensemble Encoding (EEE)

This repo is for the detailed cell model CA229. It includes the simulation, analysis and plotting files to generate paper figures.

## Description
    Both synaptic AMPARs/NMDARs and exsynaptic NMDARs are activated by one NetStim.
    Synaptic AMPARs/NMDARs get activated 10~100 ms after the stimulation.
    Exsynaptic NMDARs get activated 15~115 ms after the stimulation.
    gmax for AMPA is 0.05nS; gmax for NMDA is 0.005nS.

## Overview of files:

### Tool files

1. CA229.py   - python class with all the cell membrane properties
        (the Geometry and 3d shape is defined in this python class as well
            --- for better usage in network or NetPyNE)

    The ratio of sodium, calcium, A-type potassium and calcium activated potassium channels can be adjusted by call the class with different ratio parameters. For example,

    Using all the default value in cell1

    ```
    cell1 = CA229()
    ```

    Setting the channel conductances to 50% of the default value in cell2

    ```
    cell2 = CA229(Na_ratio = 0.5, HVA_ratio = 0.5, LVA_ratio = 0.5, KA_ratio = 0.5, BK_ratio = 0.5)               
    ```

2. compile.py     - compile all the mod files in folder: mod

3. analysis_utils.py   - calculating the plateau amplitude, plateau duration, interspike interval and number of spikes of the voltage traces generated by model simulation.

4. utils.py    - to save figures and simulation results in a folder with name of today's date

### Simulation files
1. Fig2_Experiment.py
        - Code to add AMPA and NMDA receptors on basal[34]
        - It will generate figures and json files to store the voltage traces
        - Modify the parameters in "__main__" to choose the simulation
        - "random_2" function is used to generate random activation time within a certain range. The seed is locked for now to get consistent results.
        - The actually files for generating paper fig2 results are saved in subfolder("/Fig2/")

2. Trace_Analysis.py, Trace_Analysis_TTX.py   - Generate data analysis files and figures

3. Fig2_plot_all.py   - Plot traces at different location on soma and basal dendrites

4. Fig3_Experiment.py   
        - batch simulation of glutamate input locations range from 0.1-0.9 (step size 0.1) on 6 different basal branches. At each branch and each location, there is also normal and TTX conditions. All the simulation results are saved into json files under each subfolder.
        - The actually files for generating paper fig3 results are saved in subfolder("/Fig3")

5. Fig3_ana.py    - Loop through all the subfolders and get the plateau amplitude value at each location on each branch with a certain stimulation strength (0.7 is used currently).

6. Fig3_amp_loc    - load the distance information of each basal branch from file ("Location_Amp_adj.csv"), then merge the distance info with the analysis results for each type of NMDA mod file and plot the plateau amplitude vs. distance to soma.

7. Experiment_no_spines_Joe.py    - load the cell into NetPyNE and run simulation like Fig2_experiment  (**Author: Joe Graham**)

8. Voltage_clamp_protocol.py    - to test the voltage clamp protocols and I-V curves of each NMDA mod file.


### Other folders
1. /Fig2: comparison of different NMDA mod files
        - Fig2_exp_NMDA.py, Fig2_exp_eee.py, Fig2_exp_major.py : run experiment with each NMDA mod file
        - Fig2_Trace_Analysis_NMDA.py, Fig2_Trace_Analysis_eee.py, Fig2_Trace_Analysis_NMDA.py: analyze and generate plots of simulation with each NMDA mod file
        - Fig2_plot_all.py : compare the results of 3 NMDA mod files and plot them in one figure

2. /Fig3: Analysis of glutamate simulation location on basal dendrites and peak amplitudes in soma
        - Fig3_exp_dist_amp_NMDA.py, Fig3_exp_dist_amp_NMDAeee.py, Fig3_exp_dist_amp_major.py : batch simulation of glutamate input locations range from 0.1-0.9 (step size 0.1) on 6 different basal branches. At each branch and each location, there is also normal and TTX conditions. All the simulation results are saved into json files under each subfolder.
        - Fig3_ana_NMDA.py, Fig3_ana_NMDAeee.py, Fig3_ana_major.py : Loop through all the subfolders and get the plateau amplitude value at each location on each branch with a certain stimuation strength (0.7 is used currently).
        - Fig_amp_loc_NMDA.py, Fig_amp_loc_NMDAeee.py, Fig_amp_loc_major.py : load the distance information of each basal branch from file ("Location_Amp_adj.csv"), then merge the distance info with the analysis results for each type of NMDA mod file and plot the plateau amplitude vs. distance to soma.



### Instruction:

    - Compile mod files: python compile.py

    - Add parameters for testing in "main" of each experiment file, eg.
    Fig2_Experiment.py
        (change number pool1 of synaptic AMPARs and NMDARs;
        change number pool 2 of exsyantpic NMDARs;
        change Beta and Cdur of NMDARs;
        change of stimulation location;
        change of syanptic weights;)

    - Run the file: python Fig2_Experiment.py

    - All the figures and json data will be saved in a different folder with the name of today's date.

    - Choose the correct path in "path_to_json" or "path" of each analysis or plotting file, eg. Trace_Analysis.py, Fig2_plot_all.py


## Author

**Peng Penny Gao**

## License
The project belongs to:
    Srdjan Antic's lab (https://health.uconn.edu/antic-lab/)
    Neurosim lab (http://www.neurosimlab.com)

For further information please contact: penggao.1987@gmail.com

## Other contributors
Joe W Graham, Sergio L Angulo, Salvador Dura-Bernal, Michael L Hines, William W Lytton, Srdjan D Antic
